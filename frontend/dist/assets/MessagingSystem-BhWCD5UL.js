import{r as t,y as m,j as e,g as M,h as D,i as k,k as F}from"./index-WIfzWA4V.js";const C=({isOpen:o,onClose:f,selectedChild:r})=>{const[i,n]=t.useState([]),[l,x]=t.useState(""),[b,g]=t.useState(!1),[p,y]=t.useState([]),[a,j]=t.useState(""),u=t.useRef(null);localStorage.getItem("accessToken");const c=localStorage.getItem("parent_id"),w=()=>{var s;(s=u.current)==null||s.scrollIntoView({behavior:"smooth"})};t.useEffect(()=>{w()},[i]),t.useEffect(()=>{o&&(v(),N())},[o,r]);const v=async()=>{try{y([{id:1,name:"Mrs. Sarah Johnson",subject:"Mathematics",online:!0},{id:2,name:"Mr. David Smith",subject:"English",online:!1},{id:3,name:"Ms. Emily Brown",subject:"Science",online:!0}])}catch(s){console.error("Error fetching teachers:",s)}},N=async()=>{if(!(!a||!r)){g(!0);try{const s=[{id:1,senderId:c,senderType:"parent",message:"Hello, how is my child doing in class?",timestamp:new Date(Date.now()-36e5).toISOString(),read:!0},{id:2,senderId:a,senderType:"teacher",message:"Your child is doing very well! They are very engaged in class activities.",timestamp:new Date(Date.now()-18e5).toISOString(),read:!0},{id:3,senderId:c,senderType:"parent",message:"That's wonderful to hear! Any areas we should focus on at home?",timestamp:new Date(Date.now()-9e5).toISOString(),read:!0}];n(s)}catch(s){console.error("Error fetching messages:",s),m.error("Failed to load messages")}finally{g(!1)}}},h=async()=>{if(!l.trim()||!a)return;const s={id:Date.now(),senderId:c,senderType:"parent",message:l.trim(),timestamp:new Date().toISOString(),read:!1};try{n(d=>[...d,s]),x(""),m.success("Message sent!")}catch(d){console.error("Error sending message:",d),m.error("Failed to send message"),n(E=>E.filter(I=>I.id!==s.id))}},S=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),h())},T=s=>new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl h-[600px] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-t-xl flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Messages"}),r&&e.jsxs("p",{className:"text-blue-100 text-sm",children:["Regarding: ",r.name]})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-blue-600 rounded-lg transition-colors","aria-label":"Close messaging",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 border-b bg-gray-50",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Teacher:"}),e.jsxs("select",{value:a,onChange:s=>{j(s.target.value),n([])},className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Choose a teacher..."}),p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.subject,s.online&&" ðŸŸ¢"]},s.id))]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a?b?e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading messages..."})]}):i.length===0?e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No messages yet"}),e.jsx("p",{className:"text-sm",children:"Start a conversation with your teacher!"})]}):i.map(s=>e.jsx("div",{className:`flex ${s.senderType==="parent"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${s.senderType==="parent"?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.senderType==="parent"?"text-blue-100":"text-gray-500"}`,children:T(s.timestamp)})]})},s.id)):e.jsxs("div",{className:"text-center text-gray-500 mt-10",children:[e.jsx(D,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Select a teacher to start messaging"})]}),e.jsx("div",{ref:u})]}),a&&e.jsxs("div",{className:"p-4 border-t bg-gray-50",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("textarea",{value:l,onChange:s=>x(s.target.value),onKeyPress:S,placeholder:"Type your message...",className:"flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none",rows:"2"}),e.jsx("button",{onClick:h,disabled:!l.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center","aria-label":"Send message",children:e.jsx(F,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})}):null};export{C as default};
